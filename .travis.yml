sudo: required
services:
- docker
language: ruby
rvm:
- 2.3.1
env:
  global:
  - secure: ND69gJ0h5JB0I7mogcjIwAr+3lc815M0L9i9xg7CKVdtMKyuLIT/QKoqAJ9ivnYCapnRrxweRco82VlrFz6hru5phhEiCHLLmdyYngZcjVOnTWVLanc9juQ+cz/65lqJl7MbwZxKbdurh4/2FzGoTCMdjIYzMDk+pT0hHHiZ+8p492mj0hdglGX1WfoQJvIsvR94jy+JEDsjzlB6odk+uhD2qlhK0/k2UDG8tlbEPp/zf2dvonhud3TmdvkiVTNKPS1kpB1BJCwkhNfg7ZRKkt0FMMR/g1GAfHlRE/FiUaVCyurUaUVnfAUvhuGZ28XhHotRCogP6YV6hkpWy7wyelool4c+CzSho4cdEwNFiNXME5wbpMUiZN5w9YTBBK11u2uPrhw2tUvJtjNQdvvKKdQw404hPcVaLsGaviK3G6qC1huo3kRQW51HgBF8J99+icCDgTyM+m+iJrQwCGU+darpv/ozpczoM9avE6EOF1Nu+35iRAdu5o4KR4k5EDf7AlXck1B0n5aAYj7t624cVKIF9vusOq7nmT63N8m37ZBWz09aAHasW0bm6ReB6+uOFM776Umh3/A6hr0zYrqiaQuk1zw2PNR5twvrqSLqEAwEK9ozROe3bWMdFlZhoCWNzaKNqMCt0O8B1k5xPClx3uhI63XeykxMWMDFLfvQNtw=
  - secure: a8pa0anxghVr07pT2Nkn1cr4A+wcbFE+x5jykDS1hwpvM8okolthT5TsfHerLjTGa0nDIbTN5KKwr1qa50nTClbAGAEqbmsIljTXlTfhneLB5Sik67SXaJDuoaEfYyNkngNE0S91AL6/pnOkN90zaNlBxdSzkKj1cytd/hHN896e5OSGnu6u8UK9z2VJiebO+AzEBxVuDt7urBhA9Hz1vcw8WbbFhRKEaC5rVhkrkJnPMDSHLgbNLyW1/T1aITgfHeZ2UHzDZ0BvaTXFZvnphbIWKypy/LDDNQ/qYNTVfndonEgchOCmwb8ybaVOjKz0uVLq2TexPrTuoESelLRmdYAVfmlFTEmwzrJneymqJ7IWMgqaRcSDrPV08dWPbZ4z2fdcHSoushD8rSYsAqoHsdYeuwcdtVH7UhDfE5R5jyEpck3OSsstVJ0A61qhGH0fXit4rRgu+vEcTvN5YK+1BBYGzK6CVcxxPleMjgaWwNGuS+dEc+Q/im5MbrGahjN91XLLg6Q8Be8Ep7Q5gPPMTs67wLO7HpjAXp2vND4Y6fgnbh3awovBJrdYXxoll1Xf0ddawE29EZi3LtvzUvy3xV+mWgA62r9jMdEjIMDnm0Nx+i+tdxCJJiGM4oGInMFv25yOdEWt0rjtH7BniXK7FDaSJM7K6tR639KvfaRTi3U=
  - secure: fekwijapVdOV9dt4ouCrXxvGxqmyjChtWweMu1gpUNDh743CTvbhDjXZy+NfON5kUZJ2pRaxOoa1PRsmOvhFryIOnE71trNEmnkgydJoGTmflGnjFqdk++t5UNYrhaWj5NdG8unpQZRvggeam2uDx3c6rZlrJjJfJ9pyhLZGuvZPlUHIGcBbe8uQPSPcfk/z23OeKzTlRkxNDZHcz3UGNlaeuc0ndtpoHHPn/DaCPwfbyeTuYYhM0MZanXpKam2l5mrm7FJhOYL2uXngNYnxHmzOurmMsUr0zlXbrZiqFHXu5icvPrl5yYEtAdS4saP7tIru0e+JDnKyGEOITRzmT0wglgAbef+UqYIwaJKXnr9Eb0Q75V7QtpK7atpaT8/KIbtpqF2xMblQ6LbJVmEbwQ9yB2Jj/09Gbucmfe8J+GyljuebIpVwz8oEywZuVFwmtBN6ix1CPftVpe9s+258IHl+AxZkbg4wIZwsEGA8qYonUrNdoDSQmHnXcgECl4y5spr292191oer4ZRVTIVKgLTsHcZOTbHg9xoYmkDITXhdDiUql12Q5X29C6u1gSr23Zp5fGzUwaHrqUb8dz6FvsLaIMjOXbUXeARbSgV5qFvhnkxhblaKCpdBki8ylzXPHfPXbl5sLfg6ifKBWy5jcsMuXAU9ABblSMuYDngIE/4=
  - secure: GTrZszTC3TVWypczOOmU7Zo8as1y0YwoBU6DXwX/w4jF3n8aKTf4FtCNx1jBGAcPqPZahRudotR7sPX7ZHnSB4iFK+EVtUoKNt8aC/CyEfdc06hTtalIB9dhNOZEAStkD2PP94ipxab71tUQU1PLPvhRtfbfRwTsQWxQL4gQXMhjTIr9AqQKLTMFj9o4ibVMhN9+Wx35M7C0Wc/psRo28w9emAhyX0gMMzoQGVLP/Y0sloT/NpGAKJ7yiZXYbEJiYjWkjuRA/mIJGXU7GcfcVCJRglQvPq9Tb5CciW2UGp0qc/xfDPObTFaGFDokor3phefXPN4x80Q454pp+YDUIAnLY/0PUZ3i/mnOn6zbdNkdrI+Gc6xglxbwLvFvOUW8vuBTh9SnJjMBHgzTI89cuLp2a9e0HncsCUUCCRr/zifRvW15koU03QQEx9blf3s6Qmqeludvh89/jjteMca7mLQsFFBSMuKTXVq38CgqnvK2pt1jhw4bT2aRrsa0RszutvacWSKljdUlH6RTB9JRVwbGuWapD6TXt7tmOpc0kqKLweFmYxySzITp8EhCbVdmSgexB3tZLlR4y4UqStqsmT1JHRz5yTgPtnxmXDdW5eHdqmxP0I0z5E5eX3qdKVt8NYAP4/hjVj2JyDGXIk7fuK8pYA4d3t7o1n263/b/41M=
before_install:
  - sudo apt-get update
  - sudo DEBIAN_FRONTEND=noninteractive apt-get -y -o Dpkg::Options::="--force-confdef" -o Dpkg::Options::="--force-confnew" install docker-engine
install: bundle
script:
- rake test
- rake build
deploy:
  provider: rubygems
  gem: minke
  on:
    branch: master
  api_key:
    secure: NfDL67sdeJ0FOSYns+VKjPPk/ZAhJa/wpffw5RiXG94gst5XUtZauik1nVIrTpWYhw5e34hqHPH9mE+v8AkXQRmGyUkYbW+0ePFuqBHidsSFGUOzg3h0+wYrOkvA60REJAg1EM97IDx7PmhcxfO3NFsDvr6RKOXaNc3cLxmiIdD9PVktm75hk2BvoiuO3d12ph2Wr9RjSuidX/0z2H8oOdDs8e14x9QPqX3LuRiTe+A3h+hjZ1OhH9aT5blJ2ZI65iDMY1K6hzcDuUY7CzCbKZF2pPEkDgtT5FgRX1klu28Ehxebef/vvAFmOt5ztuXyE6nEdoI8NACE7XXQQC+6H5PzE6hWoHKk7/vMn5u2pdMRUykArAJ6++JxRSitaKSXn0xZfRKvszp00WhHiG4kPtQXgNKiJiuOKX9huy+gHssYfP3sxcd0LNrslnxaGRAn0igRHuBeaIi8kxL+03q1tCSjOcc6OV9qPIgZAiGUdeeolefrXFTovptcG5PiDzq6jJoQSO51kRMhG/XGfuf2T+vpl5ouT2dsYSz8qDchX5LEjcjuBXb3J1/Xz5s1oQjGI1w+bSrZ1OAFv0d5v8jcD9IyF4C7iVuqCtlc0bNkm9ZgwG+iHHj/SxezFPCttVFBS2or6YizA2xAONXkuy2g+yUDZplcX56fe0oIQsOJOjc=
after_deploy:
  - if [ "$TRAVIS_BRANCH" == "master" ]; then
    cd docker;
    docker build -t nicholasjackson/minke --build-arg BUILD_DATE=`date -u +"%Y-%m-%dT%H:%M:%SZ"` --build-arg VCS_REF=`git rev-parse --short HEAD` .;
    docker login -e="$DOCKER_EMAIL" -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD";
    docker push nicholasjackson/minke:latest;
    docker tag nicholasjackson/minke nicholasjackson/minke:1.13.16;
    docker push nicholasjackson/minke:1.13.16;
    curl https://hooks.microbadger.com/images/nicholasjackson/minke/tkpohfdrYPE0B0TL5NzLcOap4k0=;
    fi
